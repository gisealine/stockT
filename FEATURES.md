# 功能说明

## 核心功能

- 新增一个股票管理页面，只需要名称，不需要股票代码，然后在交易记录那里用下拉框选择股票名称
  - 股票管理时可选股票类型，有A股，港股，美股
- 股票详情页分几部分展示
  - 用一个表格展示当前每笔的持仓 成交价格，股数
  - 展示已平仓后产生的实际盈亏
  - 计算盈亏时，自动最大化收益，比如我连续买入了多笔，然后卖出1笔，自动用买入价最低的那笔来计算盈亏，卖空同理
  - 展示开平仓明细，买入价，卖出价，盈亏等
  - 展示成交记录明细，买入价/卖出价，不需要盈亏，支持删除
- 我想要买入、卖出支持4种交易类型，比如我直接卖出时，检查发现当前没有持仓，就应该是卖空，我买入时，发现已经有卖空仓位，就是自动平仓
- 计算盈亏时，应该先按交易日期排序，如果交易日期相同再按创建时间排序，当发现需要平仓时，自动按最大盈利匹配出在他之前交易的开仓记录
- 计算盈亏时，涉及到手续费问题，原则是在这笔交易记录被平仓时才一次性扣除手续费，比如买了100股，然后卖50股，再卖50股，买100股的手续费在第二次才被完全平仓才扣除他的手续费

- 交易记录的表中新增两个字段，手续费，税费
- 对A股来说，手续费为万1.5，买入卖出都要收，税费只有卖出才收，万分之5
- 对港股来说，手续费为万2，买入卖出都收，税费买入卖出都收，为千分之1
- 对美股来说，手续费要手动输入，税费不需要

- 首页的各股票盈亏统计用股票列表替代
- 首页的交易记录删掉
- 首页的添加交易记录按钮删除，直接展示表单

- 货币单位，美股时美元，A股时人民币，港股时港元

### 1. 交易记录管理

- ✅ **添加交易记录**：记录股票的买入或卖出操作
  - 股票名称（下拉）
  - 交易类型（买入/卖出）用radio组件
  - 交易数量（股）
  - 交易价格（元）
  - 交易日期
  - 备注信息

- ✅ **编辑交易记录**：修改已保存的交易记录

- ✅ **删除交易记录**：删除不需要的交易记录

- ✅ **查看交易记录**：以表格形式查看所有交易记录，支持：
  - 按日期倒序排列
  - 显示交易类型标签（买入/卖出）
  - 显示总金额和盈亏

### 2. 盈亏计算

系统使用 **FIFO（先进先出）** 方法自动计算每笔卖出交易的盈亏：

- 当添加卖出记录时，系统会：
  1. 查找该股票的所有买入记录
  2. 按照交易日期和创建时间的顺序（先进先出）
  3. 计算卖出数量对应的成本价
  4. 计算盈亏 = 卖出金额 - 成本金额

- 盈亏显示：
  - 盈利：绿色显示，带 + 号
  - 亏损：红色显示
  - 买入记录：不显示盈亏

### 3. 统计分析

- ✅ **总体统计**：
  - 总交易次数
  - 总买入金额
  - 总卖出金额
  - 总盈亏

- ✅ **按股票统计**：
  - 每只股票的买入/卖出数量
  - 每只股票的买入/卖出金额
  - 每只股票的累计盈亏

## 界面特性

- 🎨 现代化的 UI 设计
- 📱 响应式布局，支持移动端
- 🔍 实时数据更新
- 💾 自动保存和计算
- ⚠️ 表单验证和错误提示

## API 端点

### 交易记录
- `GET /api/transactions` - 获取所有交易记录
- `GET /api/transactions/:id` - 获取单笔交易记录
- `GET /api/transactions/stock/:stockName` - 获取某只股票的交易记录
- `POST /api/transactions` - 创建交易记录
- `PUT /api/transactions/:id` - 更新交易记录
- `DELETE /api/transactions/:id` - 删除交易记录

### 统计
- `GET /api/transactions/stats/profit-loss` - 获取盈亏统计

### 系统
- `GET /api/health` - 健康检查
- `GET /api/test-db` - 测试数据库连接

## 数据模型

### transactions 表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键，自增 |
| stock_name | VARCHAR(100) | 股票名称 |
| transaction_type | ENUM('BUY', 'SELL') | 交易类型 |
| quantity | INT | 交易数量（股） |
| price | DECIMAL(10,2) | 交易价格 |
| transaction_date | DATE | 交易日期 |
| total_amount | DECIMAL(12,2) | 交易总金额 |
| profit_loss | DECIMAL(12,2) | 盈亏金额 |
| notes | TEXT | 备注 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

